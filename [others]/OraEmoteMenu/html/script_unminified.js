
var emoteFavoriteList = [];
var tabOpen = "expressions";

var preferences = {};

$(function(){
	window.onload = (e) => {
		window.addEventListener('message', (event) => {
			var item = event.data;
			if (item !== undefined && item.type === "ui") {
				if (item.display === true) {
                    $("#box").show();
				} else{
                    $("#box").hide();
                }
			}
            if (item !== undefined && item.type === "receiveFavorite") {
                emoteFavoriteList = JSON.parse(item.data);
                $('#favorite').empty();
                for(let favoriteEmote of emoteFavoriteList) {
                    let emoteTemplate = `<div class="content-item" data-name="` + favoriteEmote.emote + `"><div class="content-item-favorite-button favorite-active"><i class="fa-solid fa-star"></i></div>  <div class="content-item-name"> <span>` + favoriteEmote.emote.charAt(0).toUpperCase() + favoriteEmote.emote.slice(1) + `</span></div></div>`;
                    $('#favorite').append(emoteTemplate);
                }
                createEmoteList();
            }
            if (item !== undefined && item.type === "receivePreferences") {
                preferences = JSON.parse(item.data);
                createEmoteList();
            }
		});
        $('#expressions').show();
        $('#expressions').addClass("active");
        for(let elt of document.getElementsByClassName('navbar-item')) {
            if(elt.dataset.name === "expressions") {
                elt.classList.add("active");
            }
            elt.addEventListener('click', (e) => {
                let type = elt.dataset.name;
                let id = "#" + type;
                tabOpen = type;
                document.getElementById("search-input").value = "";
                $(id).show();
                $(id).addClass("active");
                //Show wich tab is open
                elt.classList.add("active");
                for(let eltm of document.getElementsByClassName('navbar-item')) {
                    if(eltm.dataset.name !== type) {
                        let id = "#" + eltm.dataset.name;
                        $(id).hide();
                        $(id).removeClass("active");
                        eltm.classList.remove("active");
                    }
                }
                for(let eltm of document.getElementsByClassName('content')) {
                    for(let emote of eltm.children) {
                        emote.style.display = "flex";
                    }
                }
                searchEmote();
            });
        }
        document.onkeyup = function (data) {
            if (data.which == 27) {
                $.post('https://OraEmoteMenu/exit', JSON.stringify({}));
                return;
            }
        }
        $("#close-box").click(() => {
            $.post('https://OraEmoteMenu/exit', JSON.stringify({}));
        });
        $("#stop-walk-expression-button").click(() => {
            $.post('https://OraEmoteMenu/DisableWalkExpression', JSON.stringify({}));
        });
        // On input focus
        $(':input').on('focus', function() {
            $.post('https://OraEmoteMenu/DisableInput', JSON.stringify({}));
        });
        
        // When focus is lost
        $(':input').on('blur', function() {
            $.post('https://OraEmoteMenu/EnableInput', JSON.stringify({}));
        });
	};
});


function updateFavoriteStatus() {
    for(let emoteFavorite of document.getElementsByClassName('favorite-inactive')) {
        emoteFavorite.addEventListener('click', (e) => {
            let emote = emoteFavorite.parentElement.dataset.name;
            console.log("Add " + emote + " to favorite");
            $.post('https://OraEmoteMenu/addFavoriteEmote', JSON.stringify({emote: emote}));
        })
    }
    for(let emoteFavorite of document.getElementsByClassName('favorite-active')) {
        emoteFavorite.addEventListener('click', (e) => {
            let emote = emoteFavorite.parentElement.dataset.name;
            console.log("remove " + emote);
            $.post('https://OraEmoteMenu/removeFavoriteEmote', JSON.stringify({emote: emote}));
        })
    }
}

function searchEmote() {
    let searchInput = document.getElementById("search-input");
    searchInput.addEventListener('input', (e) => {
        let search = searchInput.value;
        for(let elt of document.getElementById(tabOpen).children) {
            if(elt.dataset.name.toLowerCase().includes(search.toLowerCase())) {
                elt.style.display = "flex";
            } else {
                elt.style.display = "none";
            }
        }
    });
}

function createEmoteList() {
    let stopButton = '<div class="content-item" data-name="stop-current"><div class="content-item-name reset-button"> <span>Réinitialiser</span></div></div>';

    for(let elt of animationType) {
        let id = "#" + elt.toLowerCase();
        $(id).empty();
        animThatHaveOptionButtons[elt] && $(id).append(stopButton)
        for(let emote of emotes[elt]) {
            let favorite = false;
            for(let emoteFavorite of emoteFavoriteList) {
                if(emote === emoteFavorite.emote) {
                    favorite = true;
                }
            }
            let emoteTemplate = `<div class="content-item" data-name="` + emote + `">` + (favorite ? `<div class="content-item-favorite-button favorite-active">` : `<div class="content-item-favorite-button favorite-inactive">`)+ (favorite ? `<i class="fa-solid fa-star"></i>` : `<i class="fa-regular fa-star"></i>`) + `</div><div class="content-item-name"> <span>` + emote.charAt(0).toUpperCase() + emote.slice(1) + `</span></div>` + (animThatHaveOptionButtons[elt] ? '<div class="content-item-save ' + (preferences[elt.toLowerCase()] == emote ? 'checked"> <i class="fa-solid fa-check' : '"> <i class="fa-solid fa-check') + '"></i></div>' : "") + `</div>`;
            $(id).append(emoteTemplate);
        }
    }
    for (let elt of document.getElementsByClassName("content-item-name")) {
        elt.addEventListener("click", (e) => {
            if ("stop-current" == elt.parentNode.dataset.name) {
                if ("expressions" === tabOpen && "" === preferences[tabOpen]) {
                    $.post("https://OraEmoteMenu/playEmote", JSON.stringify({ name: "Défaut" }));
                    return;
                }
                if ("walks" === tabOpen && "" !== preferences[tabOpen]) $.post("https://OraEmoteMenu/playEmote", JSON.stringify({ name: "Défaut" })), 
                
                $.post("https://OraEmoteMenu/playEmote", JSON.stringify({ name: preferences[tabOpen] }));
            } else {
                $.post("https://OraEmoteMenu/playEmote", JSON.stringify({ name: elt.parentNode.dataset.name }));
            }
        });
    }
    for (let saveBtn of document.getElementsByClassName("content-item-save")) {
        saveBtn.addEventListener("click", (e) => {
            let a = saveBtn.parentNode.dataset.name,
                t = tabOpen;
            void 0 === preferences[t] && (preferences[t] = ""), (preferences[t] = preferences[t] === a ? "" : a), $.post("https://OraEmoteMenu/savePreferences", JSON.stringify({ data: preferences }));
        });
    }
    updateFavoriteStatus();
}

const animThatHaveOptionButtons = {
    "Expressions": true,
    "Walks": true,
}

const animationType = [
    "Expressions",
    "Walks",
    "Shared",
    "Dances",
    "Emotes",
    "PropEmotes",
]

const emotes = {
    "Expressions": [
        "Angry",
        "Drunk",
        "Dumb",
        "Electrocuted",
        "Grumpy",
        "Grumpy2",
        "Grumpy3",
        "Happy",
        "Injured",
        "Joyful",
        "Mouthbreather",
        "Never Blink",
        "One Eye",
        "Shocked",
        "Shocked2",
        "Sleeping",
        "Sleeping2",
        "Sleeping3",
        "Smug",
        "Speculative",
        "Stressed",
        "Sulking",
        "Weird",
        "Weird2"
    ],
    "Walks": [
        "Alien",
        "Armored",
        "Arrogant",
        "Brave",
        "Casual",
        "Casual2",
        "Casual3",
        "Casual4",
        "Casual5",
        "Casual6",
        "Chichi",
        "Confident",
        "Cop",
        "Cop2",
        "Cop3",
        "Default Female",
        "Default Male",
        "Déterminer",
        "Drunk",
        "Drunk2",
        "Drunk3",
        "Femme",
        "Fire",
        "Fire2",
        "Fire3",
        "Flee",
        "Franklin",
        "Gangster",
        "Gangster2",
        "Gangster3",
        "Gangster4",
        "Gangster5",
        "Grooving",
        "Grooving2",
        "Gros",
        "Guard",
        "Handcuffs",
        "Heels",
        "Heels2",
        "Hiking",
        "Hipster",
        "Hobo",
        "Hurry",
        "Janitor",
        "Janitor2",
        "Jog",
        "Jogging2",
        "Lemar",
        "Lester",
        "Lester2",
        "Maneater",
        "Michael",
        "Money",
        "Muscle",
        "Musclé",
        "Posh",
        "Posh2",
        "Quick",
        "Runner",
        "Sad",
        "Sassy",
        "Sassy2",
        "Scared",
        "Sexy",
        "Shady",
        "Slow",
        "Sombre",
        "Stylé",
        "Swagger",
        "Tough",
        "Tough2",
        "Trash",
        "Trash2",
        "Trevor",
        "Wide"
    ],
    "Shared": [
        "baseball",
        "baseballthrow",
        "bro",
        "bro2",
        "give",
        "give2",
        "handshake",
        "handshake2",
        "headbutt",
        "headbutted",
        "hug",
        "hug2",
        "punch",
        "punched",
        "slap",
        "slap2",
        "slapped",
        "slapped2",
        "stickup",
        "stickupscared"
    ],
    "Dances": [
        "ambiancemeuf",
        "bloodwalk",
        "cripwalk3",
        "curvette",
        "dance",
        "dance2",
        "dance3",
        "dance4",
        "dance5",
        "dance6",
        "dance7",
        "dance8",
        "dance9",
        "danceapplaudit",
        "dancef",
        "dancef2",
        "dancef3",
        "dancef4",
        "dancef5",
        "dancef6",
        "danceglowstick",
        "danceglowstick2",
        "danceglowstick3",
        "dancehorse",
        "dancehorse2",
        "dancehorse3",
        "danceshy",
        "danceshy2",
        "dancesilly",
        "dancesilly2",
        "dancesilly3",
        "dancesilly4",
        "dancesilly5",
        "dancesilly6",
        "dancesilly7",
        "dancesilly8",
        "dancesilly9",
        "danceslow",
        "danceslow2",
        "danceslow3",
        "danceslow4",
        "danceupper",
        "danceupper2",
        "dehanchemeufbasdroite",
        "dehanchemeufbasgauche",
        "dehanchemeufhautdroite",
        "dehanchemeufhautgauche",
        "dougie",
        "drill",
        "drill10",
        "Drill11",
        "drill2",
        "drill3",
        "drill4",
        "drill5",
        "Drill6",
        "drill7",
        "drill8",
        "drill9",
        "Egyptiennemeuf",
        "festival1",
        "haiphuthon",
        "hole",
        "millyrocks",
        "moodswings",
        "pistoletdroite",
        "respect",
        "robotarticule",
        "shmoney",
        "shootit",
        "simplemeuf",
        "slowcalme",
        "thotiana",
        "tokyochall",
        "uncle",
        "whatyouknowboutlove",
        "woowalkinx",
        "zoukmeuf",
        "zoumbacafew"
    ],
    "Emotes": [
        "adjust",
        "adjusttie",
        "airguitar",
        "airplane",
        "airsynth",
        "argue",
        "argue2",
        "atm",
        "ballas",
        "bangbang",
        "bark",
        "bartender",
        "bbq",
        "beast",
        "bike1",
        "bike2",
        "bike3",
        "bike4",
        "bird",
        "blowkiss",
        "blowkiss2",
        "boi",
        "bow",
        "bow2",
        "bow3",
        "boxing",
        "boxing2",
        "brasdansledos",
        "brasdevant",
        "bringiton",
        "bumbin",
        "bumsleep",
        "carlowrider",
        "carlowrider2",
        "carsign",
        "carsign2",
        "ceinturons",
        "celebrate",
        "celeste",
        "celeste2",
        "ch",
        "checkout",
        "checkout",
        "checkout2",
        "checkw",
        "checkwatch",
        "cheer",
        "chicken",
        "chill",
        "chinup",
        "clap",
        "clapangry",
        "cleanleg",
        "clipboard2",
        "cloudgaze",
        "cloudgaze2",
        "clown",
        "clown2",
        "clown3",
        "clown4",
        "clown5",
        "comeatmebro",
        "cop",
        "cop2",
        "cop3",
        "copbeacon",
        "cough",
        "countdown",
        "covermale2",
        "cpr",
        "cpr2",
        "crawl",
        "crossarms",
        "crossarms2",
        "crossarms3",
        "crossarms4",
        "crossarms5",
        "crossarms6",
        "crossarmsside",
        "curtsy",
        "cutthroat",
        "cutthroat2",
        "damn",
        "damn2",
        "ddealer",
        "depressed",
        "dgrave",
        "dj",
        "dj",
        "dj2",
        "dj3",
        "dj4",
        "doglay",
        "dogsit",
        "dontkillme",
        "drink",
        "eat",
        "facepalm",
        "facepalm2",
        "facepalm3",
        "facepalm4",
        "fakepunch",
        "fallasleep",
        "fallover",
        "fallover2",
        "fallover3",
        "fallover4",
        "fallover5",
        "families",
        "ffb",
        "fightme",
        "fightme2",
        "filmshocking",
        "finger",
        "finger2",
        "fishdance",
        "flex",
        "flip",
        "flip2",
        "flipoff",
        "flipoff2",
        "foldarms",
        "foldarms2",
        "gangaim",
        "gangdrink",
        "gangdrink",
        "gangsign",
        "gangsign2",
        "gangsign5",
        "gilet1",
        "gilet2",
        "gilet3",
        "gilet4",
        "gilet5",
        "gilet6",
        "holddecals_clip",
        "cigarlighter1_clip",
        "custodyhold2_clip",
        "handheldrandom1_clip",
        "dispatchidle1_clip",
        "custodyhold1_clip",
        "idlestanier1_clip",
        "detbadge2_clip",
        "armsgesture1_clip",
        "burgershotbag_clip",
        "gunpointstanier1_clip",
        "copradio_clip",
        "code4_clip",
        "policebodycam1_clip",
        "relaxpolice_clip",
        "idleingcop1_clip",
        "policeriot1_clip",
        "bodycam_clip",
        "detectivecam_clip",
        "stillbrazypose1_clip",
        "riottonfa1_clip",
        "pocketreach1_clip",
        "ceremonialpose1_clip",
        "ceremonialpose2_clip",
        "ceremonialpose3_clip",
        "handheldradio2_clip",
        "handheldradio1_clip",
        "handcuffbrazy3_clip",
        "ballisticshield1_clip",
        "policeanim2_clip",
        "policeanim1_clip",
        "pointface2_clip",
        "idlecop4_clip",
        "pointface_clip",
        "code4unit_clip",
        "bodycamaction_clip",
        "wantedpaper_clip",
        "posearrest_clip",
        "carryshield_clip",
        "tccollision_clip",
        "torchradio2_clip",
        "torchradio1_clip",
        "liquorpose_clip",
        "detbadge_clip",
        "posedet1_clip",
        "clipboardhang1_clip",
        "handsupbystander_clip",
        "waterbottlecop_clip",
        "entercarpolice1_clip",
        "scoutarrest1_clip",
        "scoutarrest2_clip",
        "gunpoint3_clip",
        "gunpoint2_clip",
        "gunpoint_clip",
        "metrocigar2_clip",
        "metropose2_clip",
        "metropose1_clip",
        "metrocigar1_clip",
        "dispatchpose1_clip",
        "gunpointradio2_clip",
        "standingpose2_clip",
        "gunpointradio1_clip",
        "standingpose1_clip",
        "policemegaphone_clip",
        "golfswing",
        "gotc",
        "gready",
        "guard",
        "guardaim",
        "hammer",
        "handshake",
        "handshake2",
        "handsup",
        "hangout",
        "headbutt",
        "hiking",
        "hlstwalk",
        "hlststop",
        "hmassage",
        "hltwalk",
        "hlthold",
        "hos",
        "hos2",
        "hug",
        "hug2",
        "hug3",
        "idle",
        "idle10",
        "idle11",
        "idle2",
        "idle3",
        "idle4",
        "idle5",
        "idle6",
        "idle7",
        "idle8",
        "idle9",
        "idledrunk",
        "idledrunk2",
        "idledrunk3",
        "impatient",
        "imtellingyou",
        "inspect",
        "janitor",
        "jazzhands",
        "jog",
        "jog2",
        "jog3",
        "jog4",
        "jog5",
        "jogger",
        "jogger2",
        "jumpingjacks",
        "karate",
        "karate2",
        "keyfob",
        "khaby",
        "kneel",
        "kneel2",
        "kneel3",
        "knock",
        "knock2",
        "knucklecrunch",
        "k9pose",
        "lao",
        "lapdance",
        "lapdance2",
        "lapdance3",
        "lapdance3",
        "lastday",
        "leafblower",
        "lean",
        "lean2",
        "lean3",
        "lean4",
        "lean5",
        "leanbar",
        "leanbar2",
        "leanbar3",
        "leanbar4",
        "leancar",
        "leanflirt",
        "leanhigh",
        "leanhigh2",
        "leanside",
        "leanside2",
        "leanside3",
        "leanside4",
        "leanside5",
        "ledge",
        "lfh",
        "lift",
        "listenmusic",
        "lmic",
        "lockcar",
        "lol",
        "lol2",
        "lookatplayer",
        "lookout",
        "lookplan",
        "maleprepgears",
        "maid",
        "mara",
        "me",
        "mechanic",
        "mechanic2",
        "mechanic3",
        "mechanic4",
        "medic",
        "medic2",
        "meditate",
        "meditate2",
        "meditate3",
        "metal",
        "mindblown",
        "mindblown2",
        "mindcontrol",
        "mindcontrol2",
        "mleaning",
        "morgue",
        "mstretch",
        "musician",
        "namaste",
        "nervous",
        "nervous2",
        "nervous3",
        "no",
        "no2",
        "nosepick",
        "notepad2",
        "noway",
        "noway",
        "ok",
        "outofbreath",
        "overhere",
        "parkingmeter",
        "party",
        "passout",
        "passout",
        "passout2",
        "passout3",
        "passout4",
        "passout5",
        "pbox",
        "peace",
        "peace2",
        "pee",
        "peek",
        "petting",
        "picking",
        "pickup",
        "pickup",
        "pls",
        "point",
        "pointdown",
        "pointright",
        "prone",
        "prosthigh",
        "prostlow",
        "puddle",
        "pull",
        "pullover",
        "punching",
        "push",
        "push2",
        "pushup",
        "rabbit",
        "radio",
        "radio2",
        "radio3",
        "reaching",
        "reactanger",
        "reactbye",
        "reactdamn",
        "reacteasy",
        "reactgoodc",
        "reactgreat",
        "reacthello",
        "reactiona",
        "reactıwill",
        "reactno",
        "reactnoway",
        "reactscrew",
        "reactshock",
        "reactwhy",
        "readmessages",
        "readmessages2",
        "record",
        "salute",
        "salute2",
        "salute3",
        "scared",
        "scared2",
        "screwyou",
        "secretservice",
        "Selfie1",
        "Selfie2",
        "selfie3",
        "selfie4",
        "selfie5",
        "selfiewc",
        "shakeoff",
        "shot",
        "showboobs",
        "showboobs2",
        "shrug",
        "shrug2",
        "sit",
        "sit2",
        "sit3",
        "sit4",
        "sit5",
        "sit6",
        "sit7",
        "sit8",
        "sit9",
        "sitchair",
        "sitchair10",
        "sitchair2",
        "sitchair3",
        "sitchair4",
        "sitchair5",
        "sitchair6",
        "sitchair7",
        "sitchair8",
        "sitchair9",
        "sitchairside",
        "sitdrunk",
        "sitlean",
        "sitsad",
        "sitscared",
        "sitscared2",
        "sitscared3",
        "situp",
        "slap",
        "sleep",
        "slide",
        "slide2",
        "slide3",
        "slowclap",
        "slowclap2",
        "slowclap3",
        "slugger",
        "smell",
        "smoke",
        "smokeweed",
        "spiderman",
        "standingf",
        "standingfit",
        "standingm",
        "standingt",
        "statue",
        "statue2",
        "statue3",
        "stickup",
        "stink",
        "strangulate",
        "stretch",
        "stretch2",
        "stretch3",
        "stretch4",
        "stretchl",
        "stumble",
        "stunned",
        "suit",
        "sunbathe",
        "sunbathe2",
        "sunbathe3",
        "sunbatheback",
        "sunbathem",
        "sunbathem2",
        "superhero",
        "superhero2",
        "surrender",
        "swatch",
        "t",
        "t2",
        "texting",
        "textingmale",
        "tacradio",
        "thanks",
        "think",
        "think2",
        "think3",
        "think4",
        "think5",
        "threaten",
        "thumbsup",
        "thumbsup2",
        "thumbsup3",
        "toilet",
        "toilet2",
        "tryclothes",
        "tryclothes2",
        "tryclothes3",
        "tryg",
        "trynewc",
        "trynewc2",
        "tryshirtn",
        "tryshirtp",
        "tryshoes",
        "tryshoes2",
        "tsomething",
        "twerk",
        "type",
        "type2",
        "type3",
        "type4",
        "torche",
        "ucdt",
        "uncuff",
        "vagos",
        "valet",
        "valet2",
        "vsad",
        "wait",
        "wait10",
        "wait11",
        "wait12",
        "wait13",
        "wait2",
        "wait3",
        "wait4",
        "wait5",
        "wait6",
        "wait7",
        "wait8",
        "wait9",
        "waitt",
        "waittac1",
        "waittac2",
        "waittac3",
        "waittac4",
        "warmth",
        "warmup",
        "warmup2",
        "warmup3",
        "warmup4",
        "washingface",
        "wave",
        "wave2",
        "wave3",
        "wave4",
        "wave5",
        "wave6",
        "wave7",
        "wave8",
        "wave9",
        "weeding",
        "weaponpose1",
        "weld",
        "whistle",
        "whistle2",
        "windowshop",
        "wtf",
        "yeah",
        "yoga",
    ],
    "PropEmotes": [
        "backpack",
        "beer",
        "beg",
        "bong",
        "book",
        "bouquet",
        "box",
        "brief3",
        "burger",
        "camera",
        "champagne",
        "champagnespray",
        "cig",
        "cigar",
        "cigar2",
        "clean",
        "clean2",
        "clean3",
        "clipboard",
        "coffee",
        "cup",
        "dgrave1",
        "donut",
        "egobar",
        "flute",
        "guitar",
        "guitar2",
        "guitarelectric",
        "guitarelectric2",
        "joint",
        "makeitrain",
        "map",
        "mugshot",
        "notepad",
        "phone",
        "phonecall",
        "rose",
        "sandwich",
        "smoke2",
        "smoke3",
        "smoke4",
        "soda",
        "suitcase",
        "suitcase2",
        "tablet",
        "tablet2",
        "teddy",
        "whiskey",
        "wine",
    ]
}