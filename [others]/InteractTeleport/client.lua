positions = {
    --{{Teleport Marker-BLip 1 X, Teleport Marker-Blip 1 Y, Teleport Marker-Blip 1 Z, Teleport Marker 1 Heading}, {Teleport 2 X, Teleport 2 Y, Teleport 2 Z, Teleport 2 Heading}, {Red, Green, Blue}, "Text for Teleport", Vehicle can, Marker type, Blip status, {Blip id, Blip scale, Blip colour, Blip show text}, Press Key}
    -- Marker Types: https://docs.fivem.net/docs/game-references/markers/
    -- Blips types, colour: https://docs.fivem.net/docs/game-references/blips/
    -- Press key types: https://docs.fivem.net/docs/game-references/controls/
    -- Blip scale optimal is 0.9
    -- Vehicle can: true or false
    -- Blip status: true or false

    -- {
    --     {-1537.28, -577.91, 24.71, 0},
    --     {-1581.25, -562.07, 108.52, 358},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour entrer dans l'agence immobilière",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {-1581.25, -562.07, 107.54, 0},
    --     {-1537.28, -577.91, 25.71, 358},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour sortir de l'agence immobilière",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {133.06, -1293.65, 28.0, 0},
    --     {132.5, -1287.54, 28.0, 358},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour aller derrière le bar",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- }, ----unicorn
    -- {
    --     {132.5, -1287.54, 28.0, 0},
    --     {133.06, -1293.65, 28.0, 358},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour retourner dans la salle",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- }, ----unicorn
    -- {
    --     {-98.85, 367.01, 112.0, 0},
    --     {-92.88, 330.18, 141.2, 358},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour monter",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {-92.88, 330.18, 141.2, 0},
    --     {-98.85, 367.01, 112.0, 358},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour descendre",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {-59.99, 359.86, 112.0, 0},
    --     {-84.32, 325.87, 141.0, 159.93},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour monter",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {-84.32, 325.87, 141.0, 0},
    --     {-59.99, 359.86, 112.0, 244.02},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour descendre",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    --bunker lspd
    -- {
    --     {-1042.38, -828.03, 9.88, 0},
    --     {2154.83, 2920.93, -62.9, 93.37},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour descendre.",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {2154.83, 2920.93, -62.9, 0},
    --     {-1042.38, -828.03, 9.88, 136.03},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour remonter.",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    --hopital
    -- {
    --     {329.96, -600.91, 42.28, 0},
    --     {338.88, -584.24, 28.74, 33.25},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour descendre au parking",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {338.88, -584.24, 27.80, 0},
    --     {329.96, -600.91, 43.28, 60.6},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour remonter à l'acceuil",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- --hopital
    -- {
    --     {332.06, -595.56, 42.28, 0},
    --     {246.82, -1372.16, 24.54, 317.2},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour descendre à la morgue",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {246.82, -1372.16, 23.54, 0},
    --     {332.06, -595.56, 43.28, 70.55},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour remonter à l'acceuil",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- -- HOPITAL HELICO
    -- {
    --     {327.22, -603.77, 42.35, 0},
    --     {338.14, -586.85, 74.16, 317.2},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour monter à l'heliport",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {340.74, -581.50, 73.20, 0},
    --     {327.22, -603.77, 43.28, 0},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour descendre à l'acceuil",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- Wenez jsp quoi psychologue
    -- {
    --     {-996.81, 518.09, 82.77, 0},
    --     {-1902.34, -572.51, 18.1, 126.33},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour rentrer",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- },
    -- {
    --     {-1902.34, -572.51, 18.1, 0},
    --     {-996.81, 518.09, 82.77, 153.3},
    --     {36, 237, 157},
    --     "Appuyez sur ~INPUT_CONTEXT~ pour sortir",
    --     false,
    --     27,
    --     false,
    --     {12, 0.9, 0, "Location teleport name"},
    --     38,
    --     {1.501, 1.5001, 0.5001}
    -- }
}

vehicle_message = "~r~Tu ne peux pas te tp dans un véhicule !"
novehcile_message = "~r~Vous entrez / sortez sans véhicule !"

Citizen.CreateThread(
    function()
        while true do
            Citizen.Wait(5)
            local player = PlayerPedId()
            local playerLoc = GetEntityCoords(player)

            for _, location in ipairs(positions) do
                teleport_text = location[4]
                pos1 = {
                    x = location[1][1],
                    y = location[1][2],
                    z = location[1][3],
                    heading = location[1][4]
                }


                if (GetDistanceBetweenCoords(playerLoc, pos1.x, pos1.y, pos1.z, true) < 25.0) then
                    pos2 = {
                        x = location[2][1],
                        y = location[2][2],
                        z = location[2][3],
                        heading = location[2][4]
                    }
                    ColorRed = location[3][1]
                    ColorGreen = location[3][2]
                    ColorBlue = location[3][3]
    
                    vechicle = location[5]
                    MarkerType = location[6]
    
                    PressKey = location[9]
    
                    range = {
                        p1 = location[10][1],
                        p2 = location[10][2],
                        p3 = location[10][3]
                    }
    
                    DrawMarker(
                        MarkerType,
                        pos1.x,
                        pos1.y,
                        pos1.z,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        range.p1,
                        range.p2,
                        range.p3,
                        ColorRed,
                        ColorGreen,
                        ColorBlue,
                        200,
                        0,
                        0,
                        0,
                        1
                    )
    
                    if position_verf(playerLoc.x, playerLoc.y, playerLoc.z, pos1.x, pos1.y, pos1.z, 2) then
                        help_message(teleport_text)
                        if IsControlJustReleased(1, PressKey) then
                            if vechicle == true then
                                if IsPedInAnyVehicle(player, true) then
                                    FreezeEntityPosition(player, true)
                                    DoScreenFadeOut(500)
                                    Citizen.Wait(500)
                                    DoScreenFadeIn(500)
                                    FreezeEntityPosition(player, false)
                                    SetEntityCoords(GetVehiclePedIsUsing(player), pos2.x, pos2.y, pos2.z)
                                    SetEntityHeading(GetVehiclePedIsUsing(player), pos2.heading)
                                else
                                    FreezeEntityPosition(player, true)
                                    DoScreenFadeOut(500)
                                    Citizen.Wait(500)
                                    DoScreenFadeIn(500)
                                    FreezeEntityPosition(player, false)
                                    SetEntityCoords(player, pos2.x, pos2.y, pos2.z)
                                    SetEntityHeading(player, pos2.heading)
                                    notify_message(novehcile_message)
                                end
                            elseif vechicle == false then
                                if IsPedInAnyVehicle(player, true) then
                                    notify_message(vehicle_message)
                                else
                                    FreezeEntityPosition(player, true)
                                    DoScreenFadeOut(500)
                                    Citizen.Wait(500)
                                    DoScreenFadeIn(500)
                                    FreezeEntityPosition(player, false)
                                    SetEntityCoords(player, pos2.x, pos2.y, pos2.z)
                                    SetEntityHeading(player, pos2.heading)
                                end
                            end
                        end
                    end
                end
            end
        end
    end
)

Citizen.CreateThread(
    function()
        for _, location in ipairs(positions) do
            pos1 = {
                x = location[1][1],
                y = location[1][2],
                z = location[1][3],
                heading = location[1][4]
            }

            blip_status = location[7]
            blip_id = location[8][1]
            blip_scale = location[8][2]
            blip_colour = location[8][3]
            blip_title = location[8][4]

            if blip_status == true then
                infoblip = AddBlipForCoord(pos1.x, pos1.y, pos1.z)
                SetBlipSprite(infoblip, blip_id)
                SetBlipDisplay(infoblip, 4)
                SetBlipScale(infoblip, blip_scale)
                SetBlipColour(infoblip, blip_colour)
                SetBlipAsShortRange(infoblip, true)
                BeginTextCommandSetBlipName("STRING")
                AddTextComponentString(blip_title)
                EndTextCommandSetBlipName(infoblip)
            end
        end
    end
)

function position_verf(x, y, z, cx, cy, cz, radius)
    local t1 = x - cx
    local t12 = t1 ^ 2

    local t2 = y - cy
    local t21 = t2 ^ 2

    local t3 = z - cz
    local t31 = t3 ^ 2

    return (t12 + t21 + t31) <= radius ^ 2
end

function help_message(msg)
    SetTextComponentFormat("STRING")
    AddTextComponentString(msg)
    DisplayHelpTextFromStringLabel(0, 0, 1, -1)
end

function notify_message(msg)
    SetNotificationTextEntry("STRING")
    AddTextComponentString(msg)
    DrawNotification(true, false)
end
